name: DNS Dead Check - Scheduled

on:
  schedule:
    - cron: '0 2 * * *'    # chiffres (0-9)
    - cron: '0 3 * * *'    # a
    - cron: '30 4 * * *'   # b
    - cron: '20 5 * * *'   # c
    - cron: '10 6 * * *'   # d
    - cron: '0 7 * * *'    # e
    - cron: '0 8 * * *'    # f
    - cron: '0 9 * * *'    # g
    - cron: '0 10 * * *'   # h
    - cron: '0 11 * * *'   # i j
    - cron: '0 12 * * *'   # k
    - cron: '0 13 * * *'   # l
    - cron: '0 14 * * *'   # m
    - cron: '0 15 * * *'   # n
    - cron: '0 16 * * *'   # o
    - cron: '0 17 * * *'   # p
    - cron: '0 18 * * *'   # q r
    - cron: '0 19 * * *'   # s
    - cron: '0 20 * * *'   # t
    - cron: '0 21 * * *'   # u v
    - cron: '0 22 * * *'   # w x y z

jobs:
  dns-check-scheduled:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: 3.x

      - name: Install dependencies
        run: pip install dnspython httpx

      - name: Determine prefix
        id: prefix
        run: |
          case "${{ github.event.schedule }}" in
            '0 2 * * *') echo "value=0123456789" >> $GITHUB_OUTPUT ;;
            '0 3 * * *') echo "value=a" >> $GITHUB_OUTPUT ;;
            '30 4 * * *') echo "value=b" >> $GITHUB_OUTPUT ;;
            '20 5 * * *') echo "value=c" >> $GITHUB_OUTPUT ;;
            '10 6 * * *') echo "value=d" >> $GITHUB_OUTPUT ;;
            '0 7 * * *') echo "value=e" >> $GITHUB_OUTPUT ;;
            '0 8 * * *') echo "value=f" >> $GITHUB_OUTPUT ;;
            '0 9 * * *') echo "value=g" >> $GITHUB_OUTPUT ;;
            '0 10 * * *') echo "value=h" >> $GITHUB_OUTPUT ;;
            '0 11 * * *') echo "value=ij" >> $GITHUB_OUTPUT ;;
            '0 12 * * *') echo "value=k" >> $GITHUB_OUTPUT ;;
            '0 13 * * *') echo "value=l" >> $GITHUB_OUTPUT ;;
            '0 14 * * *') echo "value=m" >> $GITHUB_OUTPUT ;;
            '0 15 * * *') echo "value=n" >> $GITHUB_OUTPUT ;;
            '0 16 * * *') echo "value=o" >> $GITHUB_OUTPUT ;;
            '0 17 * * *') echo "value=p" >> $GITHUB_OUTPUT ;;
            '0 18 * * *') echo "value=qr" >> $GITHUB_OUTPUT ;;
            '0 19 * * *') echo "value=s" >> $GITHUB_OUTPUT ;;
            '0 20 * * *') echo "value=t" >> $GITHUB_OUTPUT ;;
            '0 21 * * *') echo "value=uv" >> $GITHUB_OUTPUT ;;
            '0 22 * * *') echo "value=wxyz" >> $GITHUB_OUTPUT ;;
            *) echo "Unknown schedule" && exit 1 ;;
          esac

      - name: Run DNS checker
        run: python dns_checker.py ${{ steps.prefix.outputs.value }}

      - name: Commit dead.txt
        run: |
          git config user.name github-actions
          git config user.email github-actions@github.com
          git add dead.txt
          git commit -m "ðŸ•’ Cron update: ${{ steps.prefix.outputs.value }}" || echo "No changes"
          git push
