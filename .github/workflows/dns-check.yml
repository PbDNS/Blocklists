name: DNS Dead Check

on:
  schedule:
    - cron: '0 2 * * *'    # chiffres (0-9)
    - cron: '0 3 * * *'    # a
    - cron: '30 4 * * *'   # b
    - cron: '20 5 * * *'   # c
    - cron: '10 6 * * *'   # d
    - cron: '0 7 * * *'    # e
    - cron: '0 8 * * *'    # f
    - cron: '0 9 * * *'    # g
    - cron: '0 10 * * *'   # h
    - cron: '0 11 * * *'   # i j
    - cron: '0 12 * * *'   # k
    - cron: '0 13 * * *'   # l
    - cron: '0 14 * * *'   # m
    - cron: '0 15 * * *'   # n
    - cron: '0 16 * * *'   # o
    - cron: '0 17 * * *'   # p
    - cron: '0 18 * * *'   # q r
    - cron: '0 19 * * *'   # s
    - cron: '0 20 * * *'   # t
    - cron: '0 21 * * *'   # u v
    - cron: '0 22 * * *'   # w x y z

  workflow_dispatch:

jobs:

  dns-check-scheduled:
    if: github.event_name == 'schedule'
    runs-on: ubuntu-latest
    strategy:
      matrix:
        prefix:
          - "0123456789"
          - a
          - b
          - c
          - d
          - e
          - f
          - g
          - h
          - ij
          - k
          - l
          - m
          - n
          - o
          - p
          - qr
          - s
          - t
          - uv
          - wxyz

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Install dependencies
        run: pip install dnspython httpx

      - name: Run DNS check scheduled for prefix ${{ matrix.prefix }}
        run: python dns_checker.py "${{ matrix.prefix }}"

      - name: Commit dead.txt update
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add dead.txt
          git commit -m "Update dead.txt for prefix '${{ matrix.prefix }}'" || echo "No changes to commit"
          git push

  dns-check-manual:
    if: github.event_name == 'workflow_dispatch'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Install dependencies
        run: pip install dnspython httpx

      - name: Run DNS check manual for prefix z
        run: python dns_checker.py "z"

      - name: Commit dead.txt update manual
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add dead.txt
          git commit -m "Update dead.txt for prefix 'z' (manual run)" || echo "No changes to commit"
          git push
