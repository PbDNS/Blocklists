name: DNS Dead Check

on:
  schedule:
    - cron: '0 2 * * *'    # chiffres (0-9)
    - cron: '0 3 * * *'    # a
    - cron: '30 4 * * *'   # b
    - cron: '20 5 * * *'   # c
    - cron: '10 6 * * *'   # d
    - cron: '0 7 * * *'    # e
    - cron: '0 8 * * *'    # f
    - cron: '0 9 * * *'    # g
    - cron: '0 10 * * *'   # h
    - cron: '0 11 * * *'   # i j
    - cron: '0 12 * * *'   # k
    - cron: '0 13 * * *'   # l
    - cron: '0 14 * * *'   # m
    - cron: '0 15 * * *'   # n
    - cron: '0 16 * * *'   # o
    - cron: '0 17 * * *'   # p
    - cron: '0 18 * * *'   # q r
    - cron: '0 19 * * *'   # s
    - cron: '0 20 * * *'   # t
    - cron: '0 21 * * *'   # u v
    - cron: '0 22 * * *'   # w x y z
  workflow_dispatch:

jobs:
  dns-check:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        prefix:
          - 0 - 1 - 2 - 3 - 4 - 5 - 6 - 7 - 8 - 9
          - a - b - c - d - e - f - g - h - i - j
          - k - l - m - n - o - p - q - r - s - t
          - u - v - w - x - y - z

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up script
        run: chmod +x dns-check.py

      - name: Run DNS check
        if: >
          github.event_name == 'workflow_dispatch' ||
          (github.event.schedule == '0 2 * * *' && contains('0123456789', matrix.prefix)) ||
          (github.event.schedule == '0 3 * * *' && matrix.prefix == 'a') ||
          (github.event.schedule == '30 4 * * *' && matrix.prefix == 'b') ||
          (github.event.schedule == '20 5 * * *' && matrix.prefix == 'c') ||
          (github.event.schedule == '10 6 * * *' && matrix.prefix == 'd') ||
          (github.event.schedule == '0 7 * * *' && matrix.prefix == 'e') ||
          (github.event.schedule == '0 8 * * *' && matrix.prefix == 'f') ||
          (github.event.schedule == '0 9 * * *' && matrix.prefix == 'g') ||
          (github.event.schedule == '0 10 * * *' && matrix.prefix == 'h') ||
          (github.event.schedule == '0 11 * * *' && contains('ij', matrix.prefix)) ||
          (github.event.schedule == '0 12 * * *' && matrix.prefix == 'k') ||
          (github.event.schedule == '0 13 * * *' && matrix.prefix == 'l') ||
          (github.event.schedule == '0 14 * * *' && matrix.prefix == 'm') ||
          (github.event.schedule == '0 15 * * *' && matrix.prefix == 'n') ||
          (github.event.schedule == '0 16 * * *' && matrix.prefix == 'o') ||
          (github.event.schedule == '0 17 * * *' && matrix.prefix == 'p') ||
          (github.event.schedule == '0 18 * * *' && contains('qr', matrix.prefix)) ||
          (github.event.schedule == '0 19 * * *' && matrix.prefix == 's') ||
          (github.event.schedule == '0 20 * * *' && matrix.prefix == 't') ||
          (github.event.schedule == '0 21 * * *' && contains('uv', matrix.prefix)) ||
          (github.event.schedule == '0 22 * * *' && contains('wxyz', matrix.prefix))
        run: ./dns-check.sh ${{ matrix.prefix }}

      - name: Commit dead.txt update
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add dead.txt
          git commit -m "Update dead.txt for prefix '${{ matrix.prefix }}'" || echo "No changes to commit"
          git push
