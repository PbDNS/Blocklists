name: DNS Dead Domain Checker - Horaire S√©quenc√©

on:
  schedule:
    - cron: '0 2 * * *'    # chiffres (0-9)
    - cron: '0 3 * * *'    # a
    - cron: '30 4 * * *'   # b
    - cron: '20 5 * * *'   # c
    - cron: '10 6 * * *'   # d
    - cron: '0 7 * * *'    # e
    - cron: '0 8 * * *'    # f
    - cron: '0 9 * * *'    # g
    - cron: '0 10 * * *'   # h
    - cron: '0 11 * * *'   # i j
    - cron: '0 12 * * *'   # k
    - cron: '0 13 * * *'   # l
    - cron: '0 14 * * *'   # m
    - cron: '0 15 * * *'   # n
    - cron: '0 16 * * *'   # o
    - cron: '0 17 * * *'   # p
    - cron: '0 18 * * *'   # q r
    - cron: '0 19 * * *'   # s
    - cron: '0 20 * * *'   # t
    - cron: '0 21 * * *'   # u v
    - cron: '0 22 * * *'   # w x y z
  workflow_dispatch:

jobs:
  run:
    name: Check Dead Domains
    runs-on: ubuntu-latest
    strategy:
      matrix:
        include:
          - time: '0 2 * * *'
            prefix: '0123456789'
          - time: '0 3 * * *'
            prefix: 'a'
          - time: '30 4 * * *'
            prefix: 'b'
          - time: '20 5 * * *'
            prefix: 'c'
          - time: '10 6 * * *'
            prefix: 'd'
          - time: '0 7 * * *'
            prefix: 'e'
          - time: '0 8 * * *'
            prefix: 'f'
          - time: '0 9 * * *'
            prefix: 'g'
          - time: '0 10 * * *'
            prefix: 'h'
          - time: '0 11 * * *'
            prefix: 'ij'
          - time: '0 12 * * *'
            prefix: 'k'
          - time: '0 13 * * *'
            prefix: 'l'
          - time: '0 14 * * *'
            prefix: 'm'
          - time: '0 15 * * *'
            prefix: 'n'
          - time: '0 16 * * *'
            prefix: 'o'
          - time: '0 17 * * *'
            prefix: 'p'
          - time: '0 18 * * *'
            prefix: 'qr'
          - time: '0 19 * * *'
            prefix: 's'
          - time: '0 20 * * *'
            prefix: 't'
          - time: '0 21 * * *'
            prefix: 'uv'
          - time: '0 22 * * *'
            prefix: 'wxyz'

    if: github.event.schedule == matrix.time || github.event_name == 'workflow_dispatch'
    steps:
      - uses: actions/checkout@v3

      - uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - run: |
          python -m pip install --upgrade pip
          pip install dnspython httpx

      - run: python dns_checker.py ${{ matrix.prefix }}

      - run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add dead.txt
          git diff --cached --quiet || \
            (git commit -m "üîÅ Mise √† jour automatique dead.txt (prefixes: ${{ matrix.prefix }})" && git push)
